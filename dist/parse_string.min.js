define(["parse/parse","nu/stream"],function(a){var l=Array.prototype.reduce,c=RegExp.prototype.test,g=function(b,a){return b.valueOf()===a.valueOf()},f=function(b){return function(e,d){return new a.ExpectError(e,b,null===d?"end of input":d)}},h=function(b){return a.token(g.bind(void 0,b),f(b))},j=function(b,e,d,i){return 0===e.length?a.always(b):a.bind(a.token(g.bind(void 0,e[0]),function(e,c){return new a.ExpectError(i,b,null===c?d:d+c)}),function(a){return j(b,e.slice(1),d+a,i)})},m=function(b,
a){return b[a]=b[a]||{}},n=function(b,a){l.call(a,m,b)[""]=null;return b},k=function(b,e){var d=[];Object.keys(b).forEach(function(c){1===c.length&&d.push(a.next(h(c),k(b[c],e+c)))});b.hasOwnProperty("")&&d.push(a.always(e));return a.choice.apply(void 0,d)},p=a.token(c.bind(/^.$/),f("any character")),q=a.token(c.bind(/^[a-z]$/i),f("any letter character")),r=a.token(c.bind(/^\s$/i),f("any space character")),c=a.token(c.bind(/^[0-9]$/i),f("any digit character"));return{character:h,string:function(b){return a.bind(a.getPosition(),
function(c){return a.attempt(j(b,b,"",c))})},trie:function(b){return a.attempt(k(b.reduce(n,{}),""))},anyChar:p,letter:q,space:r,digit:c}});
