define(["parse/parse","nu/stream"],function(c){var l=Array.prototype.reduce,d=RegExp.prototype.test,g=function(a,b){return a.valueOf()===b.valueOf()},f=function(a){return function(b,e){return new c.ExpectError(b,a,null===e?"end of input":e)}},h=function(a){return c.token(g.bind(void 0,a),f(a))},j=function(a,b,e,i){return 0===b.length?c.always(a):c.next(c.token(g.bind(void 0,b[0]),function(b,d){return new c.ExpectError(i,a,null===d?e:e+d)}),j(a,b.slice(1),e+b[0],i))},m=function(a,b){return a[b]=a[b]||
{}},n=function(a,b){l.call(b,m,a)[""]=null;return a},k=function(a,b){var e=[];Object.keys(a).forEach(function(d){1===d.length&&e.push(c.next(h(d),k(a[d],b+d)))});a.hasOwnProperty("")&&e.push(c.always(b));return c.choice.apply(void 0,e)},p=c.token(d.bind(/^.$/),f("any character")),q=c.token(d.bind(/^[a-z]$/i),f("any letter character")),r=c.token(d.bind(/^\s$/i),f("any space character")),d=c.token(d.bind(/^[0-9]$/i),f("any digit character"));return{character:h,string:function(a){return c.bind(c.getPosition(),
function(b){return c.attempt(j(a,a,"",b))})},trie:function(a){return c.attempt(k(a.reduce(n,{}),""))},anyChar:p,letter:q,space:r,digit:d}});
