define(["parse/parse","nu/stream"],function(b){var l=Array.prototype.reduce,c=RegExp.prototype.test,m=function(a,b){return a.valueOf()===b.valueOf()},d=function(a){return function(e,g){return new b.ExpectError(e,a,g)}},f=function(a){return b.token(m.bind(void 0,a),d(a))},h=function(a,e,g,i){var c;if(0===e.length)c=b.always(a);else{var d=b.bind(f(e[0]),function(b){return h(a,e.slice(1),g+b,i)});c=function(a,e,c,f,j,h){return d(a,e,c,function(a,e,d){return b.next(b.always(),i(g+a))(e,d,c,f,j,h)},j,
function(a,e,d){return b.next(b.always(),i(g+a))(e,d,c,f,j,h)})}}return c},n=function(a,b){return a[b]=a[b]||{}},p=function(a,b){l.call(b,n,a)[""]=null;return a},k=function(a,e){var c=[];Object.keys(a).forEach(function(d){1===d.length&&c.push(b.next(f(d),k(a[d],e+d)))});a.hasOwnProperty("")&&c.push(b.always(e));return b.choice.apply(void 0,c)},q=b.token(c.bind(/^.$/),d("any character")),r=b.token(c.bind(/^[a-z]$/i),d("any letter character")),s=b.token(c.bind(/^\s$/i),d("any space character")),c=b.token(c.bind(/^[0-9]$/i),
d("any digit character"));return{character:f,string:function(a){return h(a,a,"",function(c){return b.never(new b.ExpectError(null,a,c))})},trie:function(a){return k(a.reduce(p,{}),"")},anyChar:q,letter:r,space:s,digit:c}});
