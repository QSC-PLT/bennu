define(["parse/parse","nu/stream"],function(c){var g=Function.prototype.call.bind(Array.prototype.reduce),d=RegExp.prototype.test,h=function(a,b){return a.valueOf()===b.valueOf()},f=function(a){return function(b,e){return new c.ExpectError(b,a,null===e?"end of input":e)}},i=function(a){return c.token(h.bind(void 0,a),f(a))},k=function(a,b,e,j){return 0===b.length?c.always(a):c.next(c.token(h.bind(void 0,b[0]),function(b,d){return new c.ExpectError(j,a,null===d?e:e+d)}),k(a,b.slice(1),e+b[0],j))},
m=function(a,b){return a[b]=a[b]||{}},n=function(a,b){g(b,m,a)[""]=null;return a},l=function(a,b){var e=[];Object.keys(a).forEach(function(d){1===d.length&&e.push(c.next(i(d),l(a[d],b+d)))});a.hasOwnProperty("")&&e.push(c.always(b));return c.choice.apply(void 0,e)},p=c.token(d.bind(/^.$/),f("any character")),q=c.token(d.bind(/^[a-z]$/i),f("any letter character")),r=c.token(d.bind(/^\s$/i),f("any space character")),d=c.token(d.bind(/^[0-9]$/i),f("any digit character"));return{character:i,string:function(a){return c.bind(c.getPosition(),
function(b){return c.attempt(k(a,a,"",b))})},trie:function(a){return c.attempt(l(g(a,n,{}),""))},anyChar:p,letter:q,space:r,digit:d}});
