define(["parse/parse","nu/stream"],function(d){var h=Array.prototype.map,i=Array.prototype.reduce,c=RegExp.prototype.test,j=function(a,b){return a.valueOf()===b.valueOf()},e=function(a){return function(b,c){return new d.ExpectError(b,a,c)}},f=function(a){return d.token(j.bind(void 0,a),e(a))},k=function(a,b){return d.next(b,a)},l=function(a,b){return a[b]=a[b]||{}},m=function(a,b){i.call(b,l,a)[""]=null;return a},g=function(a,b){var c=[];Object.keys(a).forEach(function(e){1===e.length&&c.push(d.next(f(e),
g(a[e],b+e)))});a.hasOwnProperty("")&&c.push(d.always(b));return d.choice.apply(void 0,c)},n=d.token(c.bind(/^.$/),e("any character")),p=d.token(c.bind(/^[a-z]$/i),e("any letter character")),q=d.token(c.bind(/^\s$/i),e("any space character")),c=d.token(c.bind(/^[0-9]$/i),e("any digit character"));return{character:f,string:function(a){return h.call(a,f).reduceRight(k,d.always(a))},trie:function(a){return g(a.reduce(m,{}),"")},anyChar:n,letter:p,space:q,digit:c}});
