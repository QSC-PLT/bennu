define(["require","exports","nu/stream","seshat"],function(x,c,i,I){var p,O,e,k,u,v,q,h,l,J,n,r,K,j,ka,C,L,P,y,la,Q,R,S,D,T,M,U,V,W,X,Y,Z,w,$,E,s,aa,ba,ca,z,A,d,da,F,ea,fa,ga,ha,ia;s=i.end;var pa=i.first,qa=i.isEmpty,ra=i.rest;w=i.reduceRight;z=i.foldr;var sa=Function.prototype.call.bind(Array.prototype.map),ja=function(){return arguments},B=function(a){return function(){return a}};A=function(a){return function(b,f){return a(f,b)}};var ma=Math.random;p=function(a,b){var f=[a,b];f._next=!0;return f};
O=function(a){for(;a&&a._next;)a=a[0].apply(void 0,a[1]);return a};d=function(a,b){this.memoer=a;this.frames=b};d.empty=new d(I.create(function(a,b){return a.compare(b)},function(a,b){return a.id===b.id&&(a.state===b.state||a.state&&a.state.eq(b.state))}),[]);d.pushWindow=function(a,b){return new d(a.memoer,[b].concat(a.frames))};d.popWindow=function(a){return new d(1===a.frames.length?I.prune(a.memoer,a.frames[0]):a.memoer,a.frames.slice(1))};d.lookup=function(a,b,f){return I.lookup(a.memoer,b,f)};
d.update=function(a,b,f,c){return new d(I.update(a.memoer,b,f,c),a.frames)};l=function(a){this.index=a};l.initial=new l(0);l.prototype.toString=function(){return""+this.index};l.prototype.increment=function(){return new l(this.index+1)};l.prototype.compare=function(a){return this.index-a.index};h=function(a,b,f){this.input=a;this.position=b;this.userState=f};h.prototype.eq=function(a){return a&&this.input===a.input&&this.userState===a.userState};h.prototype.isEmpty=function(){return qa(this.input)};
h.prototype.first=function(){return pa(this.input)};h.prototype.next=function(a){if(!this._next){var b=new h(ra(this.input),this.position.increment(a),this.userState);this._next=function(f,c,g){return g(a,b,c)}}return this._next};h.prototype.setInput=function(a){return new h(a,this.position,this.userState)};h.prototype.setPosition=function(a){return new h(this.input,a,this.userState)};h.prototype.setUserState=function(a){return new h(this.input,this.position,a)};x=function(a){this.message=a};x.prototype=
Error();x.prototype.constructor=x;x.prototype.name="ParserError";e=function(a,b){this.position=a;this._msg=b};e.prototype=Error();e.prototype.constructor=e;e.prototype.name="ParseError";e.prototype.toString=function(){return this.name+": "+this.message};Object.defineProperties(e.prototype,{message:{configurable:!0,get:function(){return"At position:"+this.position+" "+this.errorMessage}},errorMessage:{configurable:!0,get:function(){return void 0===this._msg?"":this._msg}}});k=function(a,b){e.call(this,
a);this.errors=b||[]};k.prototype=new e;k.prototype.constructor=k;k.prototype.name="MultipleError";Object.defineProperty(k.prototype,"errorMessage",{get:function(){return"["+sa(this.errors,function(a){return a.message}).join(", ")+"]"}});var H=function(a,b,f){e.call(this,a);this._pErr=b;this._qErr=f};H.prototype=new k;H.prototype.constructor=k;H.prototype.name="ChoiceError";Object.defineProperty(H.prototype,"errors",{get:function(){return[this._pErr].concat(this._qErr.errors)}});u=function(a){e.call(this,
a)};u.prototype=new e;u.prototype.constructor=u;u.prototype.name="UnknownError";Object.defineProperty(u.prototype,"errorMessage",{value:"unknown error"});v=function(a,b){e.call(this,a);this.unexpected=b};v.prototype=new e;v.prototype.constructor=v;v.prototype.name="UnexpectError";Object.defineProperty(v.prototype,"errorMessage",{get:function(){return"Unexpected:"+this.unexpected}});q=function(a,b,f){e.call(this,a);this.expected=b;this.found=f};q.prototype=new e;q.prototype.constructor=q;q.prototype.name=
"ExpectError";Object.defineProperty(q.prototype,"errorMessage",{get:function(){return"Expected:"+this.expected+(this.found?" Found:"+this.found:"")}});J=function(a){var b=a(function(){return b.apply(this,arguments)});return b};n=function(a,b){return b.hasOwnProperty("parserId")?n(a,function(){return b.apply(this,arguments)}):Object.defineProperties(b,{displayName:{value:a,writable:!1},parserId:{value:ma(),writable:!1}})};r=function(a){return function(b,f,c,g,m){return m(a,b,f)}};K=function(a){return function(b,
f,c,g,m,d){return d(a,b,f)}};j=function(a,b){return function(f,c,g,m,d,t){return p(a,[f,c,function(a,f,c){return p(b(a,f,c),[f,c,g,m,g,m])},m,function(a,f,c){return p(b(a,f,c),[f,c,g,m,d,t])},t])}};y=function(a){return function(b,f,c,g,m){b=a(b);return m(b,b,f)}};L=n("Get Parser State",y(function(a){return a}));P=function(a){return y(B(a))};C=function(a){return function(b,c,G,g,m){return m(a(b),b,c)}};Q=function(a){return y(function(b){return b.setUserState(a(b.userState))})};la=n("Get State",C(function(a){return a.userState}));
D=n("Get Position",C(function(a){return a.position}));T=function(a){return y(function(b){return b.setPosition(a)})};R=n("Get Input",C(function(a){return a.input}));S=function(a){return y(function(b){return b.setInput(a)})};var na=function(a){return j(D,function(b){return K(a(b))})};var ta=r(s);ka=n("EOF",j(L,function(a){return a.isEmpty()?ta:na(function(b){return new q(b,"end of input",a.first())})}));M=function(a,b){return j(a,B(b))};U=w.bind(null,A(M));var ua=i.from;V=function(a){return U(ua(a))};
W=function(){return V(ja.apply(null,arguments))};w=function(a){return function(b,c){return function(G,g,m,d,t,e){var N=G.position;return p(b,[G,g,m,d,t,function(b,g,h){return p(c,[G,h,m,d,t,function(c,f,g){return e(a(N,b,c),G,g)}])}])}}};X=w(function(a,b,c){return new k(a,[b,c])});Y=z.bind(null,A(w(function(a,b,c){return new H(a,b,c)})),j(D,function(a){return K(new k(a,[]))}));var va=i.from;Z=function(a){return Y(va(a))};w=function(a,b){return X(b,r(a))};var wa=r(s),xa=w.bind(null,s);s=function(a){return function(b,
c){return j(b,function(b){return j(c,function(c){return r(a(b,c))})})}};var ya=function(a){return r(i.toArray(a))};$=function(a){return j(a,ya)};E=s(i.cons);s=s(i.append);aa=z.bind(null,A(E),wa);var za=i.from;ba=function(a){return aa(za(a))};var oa,Aa=new x("Many parser applied to a parser that accepts an empty string");oa=function(){throw Aa;};ca=function(a){var b=function(b,c,g,d,e,t){return p(a,[b,c,g,d,oa,t])};return J(function(a){return xa(E(b,a))})};var Ba=function(a,b){return new v(a,null===
b?"end of input":b)};z=function(a,b){var c=b||Ba;return function(b,g,d,e,t,h){var N=b.position;if(b.isEmpty())return h(c(N,null),b,g);var i=b.first();return a(i)?b.next(i)(b,g,d,e,t,h):h(c(N,i),b,g)}};A=n("Any Token",z(B(!0)));da=function(a,b,c,d,g,e,h){return O(a(b,c,d,g,e,h))};F=function(a,b,c,e){return da(a,b,d.empty,c,e,c,e)};ea=function(a,b,c,d,g){return F(a,new h(b,l.initial,c),d,g)};var Ca=function(a){return a},Da=function(a){throw a;};fa=function(a,b){return F(a,b,Ca,Da)};ga=function(a,b,
c){return fa(a,new h(b,l.initial,c))};var Ea=B(!0),Fa=B(!1);ha=function(a,b){return F(a,b,Ea,Fa)};ia=function(a,b,c){return ha(a,new h(b,l.initial,c))};c.tail=p;c.trampoline=O;c.ParserError=x;c.ParseError=e;c.MultipleError=k;c.UnknownError=u;c.UnexpectError=v;c.ExpectError=q;c.ParserState=h;c.Position=l;c.rec=J;c.Parser=n;c.RecParser=function(a,b){return n(a,J(b))};c.always=r;c.never=K;c.bind=j;c.eof=ka;c.extract=C;c.getParserState=L;c.setParserState=P;c.modifyParserState=y;c.getState=la;c.setState=
function(a){return Q(B(a))};c.modifyState=Q;c.getInput=R;c.setInput=S;c.getPosition=D;c.setPosition=T;c.fail=function(a){var b;var c=a?e:u;b=na(function(b){return new c(b,a)});return b};c.attempt=function(a){return function(b,c,e,g,h,i){g=function(a,b,c){return i(a,b,d.popWindow(c))};return p(a,[b,d.pushWindow(c,b.position),function(a,b,c){return e(a,b,d.popWindow(c))},g,function(a,b,c){return h(a,b,d.popWindow(c))},g])}};c.look=function(a){return j(L,function(b){return j(a,function(a){return M(P(b),
r(a))})})};c.lookahead=function(a){return j(R,function(b){return j(D,function(c){return j(a,function(a){return W(T(c),S(b),r(a))})})})};c.next=M;c.sequences=U;c.sequencea=V;c.sequence=W;c.either=X;c.choices=Y;c.choicea=Z;c.choice=function(){return Z(ja.apply(null,arguments))};c.optional=w;c.expected=function(a,b){return function(c,d,g,e,h,i){return b(c,d,g,e,h,function(b,c,f){return i(new q(c.position,a),c,f)})}};c.eager=$;c.binds=function(a,b){return j($(a),function(a){return b.apply(void 0,a)})};
c.cons=E;c.append=s;c.enumerations=aa;c.enumerationa=ba;c.enumeration=function(){return ba(ja.apply(null,arguments))};c.many=ca;c.many1=function(a){return E(a,ca(a))};c.token=z;c.anyToken=A;c.memo=function(a){var b=a.parserId||ma();return function(c,e,g,h,i,j){var k=c.position,l={id:b,state:c},n=d.lookup(e,k,l);return n?p(n,[c,e,g,h,i,j]):p(a,[c,e,function(a,b,c){return g(a,b,d.update(c,k,l,function(c,d,f){return f(a,b,d)}))},function(a,b,c){return h(a,b,d.update(c,k,l,function(c,d,f,e){return e(a,
b,d)}))},function(a,b,c){return i(a,b,d.update(c,k,l,function(c,d,f,e,g){return g(a,b,d)}))},function(a,b,c){return j(a,b,d.update(c,k,l,function(c,d,f,e,g,h){return h(a,b,d)}))}])}};c.Memoer=d;c.exec=da;c.parseState=F;c.parseStream=ea;c.parse=function(a,b,c,d,e){return ea(a,i.from(b),c,d,e)};c.runState=fa;c.runStream=ga;c.run=function(a,b,c){return ga(a,i.from(b),c)};c.testState=ha;c.testStream=ia;c.test=function(a,b,c){return ia(a,i.from(b),c)}});
