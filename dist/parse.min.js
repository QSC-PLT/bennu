define(["require","exports","nu/stream","seshat"],function(w,c,j,H){var n,M,d,k,t,u,r,h,l,I,m,x,J,q,fa,D,N,y,ga,O,ha,K,P,Q,R,S,T,U,v,V,E,s,W,X,Y,z,A,e,Z,F,$,aa,ba,ca,da;s=j.end;var la=j.first,ma=j.isEmpty,na=j.rest;v=j.reduceRight;z=j.foldr;var oa=Function.prototype.call.bind(Array.prototype.map),ea=function(){return arguments},B=function(a){return function(){return a}};A=function(a){return function(b,g){return a(g,b)}};var ia=Math.random;n=function(a,b){var g=[a,b];g._next=!0;return g};M=function(a){for(;a&&
a._next;)a=a[0].apply(void 0,a[1]);return a};e=function(a,b){this.memoer=a;this.frames=b};e.empty=new e(H.create(function(a,b){return a.compare(b)},function(a,b){return a.id===b.id&&(a.state===b.state||a.state&&a.state.eq(b.state))}),[]);e.pushWindow=function(a,b){return new e(a.memoer,[b].concat(a.frames))};e.popWindow=function(a){return new e(1===a.frames.length?H.prune(a.memoer,a.frames[0]):a.memoer,a.frames.slice(1))};e.lookup=function(a,b,g){return H.lookup(a.memoer,b,g)};e.update=function(a,
b,g,c){return new e(H.update(a.memoer,b,g,c),a.frames)};l=function(a){this.index=a};l.initial=new l(0);l.prototype.toString=function(){return""+this.index};l.prototype.increment=function(){return new l(this.index+1)};l.prototype.compare=function(a){return this.index-a.index};h=function(a,b,g){this.input=a;this.position=b;this.userState=g};h.prototype.eq=function(a){return a&&this.input===a.input&&this.userState===a.userState};h.prototype.isEmpty=function(){return ma(this.input)};h.prototype.first=
function(){return la(this.input)};h.prototype.next=function(a){if(!this._next){var b=new h(na(this.input),this.position.increment(a),this.userState);this._next=function(g,c,f){return f(a,b,c)}}return this._next};h.prototype.setInput=function(a){return new h(a,this.position,this.userState)};h.prototype.setPosition=function(a){return new h(this.input,a,this.userState)};h.prototype.setUserState=function(a){return new h(this.input,this.position,a)};w=function(a){this.message=a};w.prototype=Error();w.prototype.constructor=
w;w.prototype.name="ParserError";d=function(a,b){this.position=a;this._msg=b};d.prototype=Error();d.prototype.constructor=d;d.prototype.name="ParseError";d.prototype.toString=function(){return this.name+": "+this.message};Object.defineProperties(d.prototype,{message:{configurable:!0,get:function(){return"At position:"+this.position+" "+this.errorMessage}},errorMessage:{configurable:!0,get:function(){return void 0===this._msg?"":this._msg}}});k=function(a,b){d.call(this,a);this.errors=b||[]};k.prototype=
new d;k.prototype.constructor=k;k.prototype.name="MultipleError";Object.defineProperty(k.prototype,"errorMessage",{get:function(){return"["+oa(this.errors,function(a){return a.message}).join(", ")+"]"}});var G=function(a,b,g){d.call(this,a);this._pErr=b;this._qErr=g};G.prototype=new k;G.prototype.constructor=k;G.prototype.name="ChoiceError";Object.defineProperty(G.prototype,"errors",{get:function(){return[this._pErr].concat(this._qErr.errors)}});t=function(a){d.call(this,a)};t.prototype=new d;t.prototype.constructor=
t;t.prototype.name="UnknownError";Object.defineProperty(t.prototype,"errorMessage",{value:"unknown error"});u=function(a,b){d.call(this,a);this.unexpected=b};u.prototype=new d;u.prototype.constructor=u;u.prototype.name="UnexpectError";Object.defineProperty(u.prototype,"errorMessage",{get:function(){return"Unexpected:"+this.unexpected}});r=function(a,b,g){d.call(this,a);this.expected=b;this.found=g};r.prototype=new d;r.prototype.constructor=r;r.prototype.name="ExpectError";Object.defineProperty(r.prototype,
"errorMessage",{get:function(){return"Expected:"+this.expected+(this.found?" Found:"+this.found:"")}});I=function(a){var b=a(function(){return b.apply(this,arguments)});return b};m=function(a,b){return b.hasOwnProperty("parserId")?m(a,function(){return b.apply(this,arguments)}):Object.defineProperties(b,{displayName:{value:a,writable:!1},parserId:{value:ia(),writable:!1}})};x=function(a){return function(b,g,c,f,i){return i(a,b,g)}};J=function(a){return function(b,g,c,f,i,e){return e(a,b,g)}};q=function(a,
b){return function(g,c,f,i,e,p){return n(a,[g,c,function(a,c,g){return n(b(a,c,g),[c,g,f,i,f,i])},i,function(a,c,g){return n(b(a,c,g),[c,g,f,i,e,p])},p])}};y=function(a){return function(b,c,C,f,i){b=a(b);return i(b,b,c)}};N=m("Get Parser State",y(function(a){return a}));D=function(a){return function(b,c,C,f,i){return i(a(b),b,c)}};O=function(a){return y(function(b){return b.setUserState(a(b.userState))})};ga=m("Get State",D(function(a){return a.userState}));K=m("Get Position",D(function(a){return a.position}));
ha=m("Get Input",D(function(a){return a.input}));var ja=function(a){return q(K,function(b){return J(a(b))})};var qa=x(s);fa=m("EOF",q(N,function(a){return a.isEmpty()?qa:ja(function(b){return new r(b,"end of input",a.first())})}));P=function(a,b){return q(a,B(b))};Q=v.bind(null,A(P));var ra=j.from;R=function(a){return Q(ra(a))};v=function(a){return function(b,c){return function(C,f,i,e,p,pa){var L=C.position;return n(b,[C,f,i,e,p,function(b,f,d){return n(c,[C,d,i,e,p,function(c,g,f){return pa(a(L,
b,c),C,f)}])}])}}};S=v(function(a,b,c){return new k(a,[b,c])});T=z.bind(null,A(v(function(a,b,c){return new G(a,b,c)})),q(K,function(a){return J(new k(a,[]))}));var sa=j.from;U=function(a){return T(sa(a))};v=function(a,b){return S(b,x(a))};var ta=x(s),ua=v.bind(null,s);s=function(a){return function(b,c){return q(b,function(b){return q(c,function(c){return x(a(b,c))})})}};var va=function(a){return x(j.toArray(a))};V=function(a){return q(a,va)};E=s(j.cons);s=s(j.append);W=z.bind(null,A(E),ta);var wa=
j.from;X=function(a){return W(wa(a))};var ka,xa=new w("Many parser applied to a parser that accepts an empty string");ka=function(){throw xa;};Y=function(a){var b=function(b,c,f,i,e,p){return n(a,[b,c,f,i,ka,p])};return I(function(a){return ua(E(b,a))})};var ya=function(a,b){return new u(a,null===b?"end of input":b)};z=function(a,b){var c=b||ya;return function(b,f,i,e,p,d){var L=b.position;if(b.isEmpty())return d(c(L,null),b,f);var h=b.first();return a(h)?b.next(h)(b,f,i,e,p,d):d(c(L,h),b,f)}};A=
m("Any Token",z(B(!0)));Z=function(a,b,c,e,f,i,d){return M(a(b,c,e,f,i,d))};F=function(a,b,c,d){return Z(a,b,e.empty,c,d,c,d)};$=function(a,b,c,e,f){return F(a,new h(b,l.initial,c),e,f)};var za=function(a){return a},Aa=function(a){throw a;};aa=function(a,b){return F(a,b,za,Aa)};ba=function(a,b,c){return aa(a,new h(b,l.initial,c))};var Ba=B(!0),Ca=B(!1);ca=function(a,b){return F(a,b,Ba,Ca)};da=function(a,b,c){return ca(a,new h(b,l.initial,c))};c.tail=n;c.trampoline=M;c.ParserError=w;c.ParseError=d;
c.MultipleError=k;c.UnknownError=t;c.UnexpectError=u;c.ExpectError=r;c.ParserState=h;c.Position=l;c.rec=I;c.Parser=m;c.RecParser=function(a,b){return m(a,I(b))};c.always=x;c.never=J;c.bind=q;c.eof=fa;c.extract=D;c.getParserState=N;c.setParserState=function(a){return y(B(a))};c.modifyParserState=y;c.getState=ga;c.setState=function(a){return O(B(a))};c.modifyState=O;c.getInput=ha;c.setInput=function(a){return y(function(b){return b.setInput(a)})};c.getPosition=K;c.setPosition=function(a){return y(function(b){return b.setPosition(a)})};
c.fail=function(a){var b;var c=a?d:t;b=ja(function(b){return new c(b,a)});return b};c.attempt=function(a){return function(b,c,d,f,i,h){f=function(a,b,c){return h(a,b,e.popWindow(c))};return n(a,[b,e.pushWindow(c,b.position),function(a,b,c){return d(a,b,e.popWindow(c))},f,function(a,b,c){return i(a,b,e.popWindow(c))},f])}};c.lookahead=function(a){return function(b,c,e,f,d,h){return n(a,[b,c,function(a,c,g){return d(a,b,g)},f,d,h])}};c.next=P;c.sequences=Q;c.sequencea=R;c.sequence=function(){return R(ea.apply(null,
arguments))};c.either=S;c.choices=T;c.choicea=U;c.choice=function(){return U(ea.apply(null,arguments))};c.optional=v;c.expected=function(a,b){return function(c,e,f,d,h,j){return b(c,e,f,d,h,function(b,c,g){return j(new r(c.position,a),c,g)})}};c.eager=V;c.binds=function(a,b){return q(V(a),function(a){return b.apply(void 0,a)})};c.cons=E;c.append=s;c.enumerations=W;c.enumerationa=X;c.enumeration=function(){return X(ea.apply(null,arguments))};c.many=Y;c.many1=function(a){return E(a,Y(a))};c.token=z;
c.anyToken=A;c.memo=function(a){var b=a.parserId||ia();return function(c,d,f,h,j,p){var k=c.position,l={id:b,state:c},m=e.lookup(d,k,l);return m?n(m,[c,d,f,h,j,p]):n(a,[c,d,function(a,b,c){return f(a,b,e.update(c,k,l,function(c,d,e){return e(a,b,d)}))},function(a,b,c){return h(a,b,e.update(c,k,l,function(c,d,e,g){return g(a,b,d)}))},function(a,b,c){return j(a,b,e.update(c,k,l,function(c,d,e,g,f){return f(a,b,d)}))},function(a,b,c){return p(a,b,e.update(c,k,l,function(c,d,e,g,f,h){return h(a,b,d)}))}])}};
c.Memoer=e;c.exec=Z;c.parseState=F;c.parseStream=$;c.parse=function(a,b,c,d,e){return $(a,j.from(b),c,d,e)};c.runState=aa;c.runStream=ba;c.run=function(a,b,c){return ba(a,j.from(b),c)};c.testState=ca;c.testStream=da;c.test=function(a,b,c){return da(a,j.from(b),c)}});
