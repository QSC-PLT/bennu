define(["stream"],function(f){var $=Array.prototype.join,aa=Array.prototype.map,J=Array.prototype.reduceRight,k=function(a){return 1===arguments.length?a:a.bind.apply(a,arguments)},w=function(a){return a},i=k(k,w),K=function(a,b){return a===b},l=function(a,b){var c=[a,b];c._next=!0;return c},j,ba=function(){return"{line: "+this.line+" col: "+this.column+"}"};j=function(a,b){return Object.freeze({line:a,column:b,toString:ba})};j.increment=function(a,b){return"\n"===b?j(a.line+1,1):j(a.line,a.column+
1)};var q=function(a,b){this.input=a;this.pos=b};q.prototype.next=function(a){return this._next||(this._next=new q(f.rest(this.input),j.increment(this.pos,a)))};var e=function(a,b){this._messages=b;this.pos=a};e.prototype=Error();e.prototype.constructor=e;e.prototype.name="ParseError";Object.defineProperties(e.prototype,{message:{get:function(){var a=this.messages;return"At position:"+this.pos+" ["+(a?$.call(a,", "):"")+"]"}},messages:{get:function(){return this._messages}}});var r=function(a,b){this.e1=
a;this.e2=b;e.call(this,a.pos)};r.prototype=new e;r.prototype.constructor=r;r.prototype.name="MultipleError";Object.defineProperty(r.prototype,"messages",{get:function(){return[this.e1.messsage,this.e2.message]}});var s=function(a){e.call(this,a,["Error"])};s.prototype=new e;s.prototype.constructor=s;s.prototype.name="UnknownError";var m=function(a,b){e.call(this,a,b?["Unexpected "+b]:b)};m.prototype=new e;m.prototype.constructor=m;m.prototype.name="UnexpectError";var t=function(a,b){e.call(this,
a,["Expected "+(b||"")])};t.prototype=new e;t.prototype.constructor=t;t.prototype.name="ExpectError";var L=function(a,b){return Object.defineProperty(b,"displayName",{value:a,writable:!1})},C=function(a){var b;return b=a(function(){return b.apply(this,arguments)})},n=function(a){return function(b,c,g,h,d){return d(a,b,c)}},D=i(function(a,b,c,g,h,d){return d(new s(a.pos),a,b)}),u=function(a,b){return function(c,g,h,d,e,f){return l(a,[c,g,function(a,c,g){return l(b(a,c),[c,g,h,d,h,d])},d,function(a,
c,g){return l(b(a,c),[c,g,h,d,e,f])},f])}},M=function(a,b){return u(a,function(a){return b.apply(void 0,f.toArray(a))})},ca=i(function(a,b,c,g,h,d){return!a.input?h(null,a,b):d(new t(a.pos,"end of input"),a,b)}),N=function(a){return function(b,c,g,h,d){return d(a(b),b,c)}},w=k(N,w),E=function(a,b){return u(a,i(b))},F=function(a,b){return function(c,g,h,d,e,f){return l(a,[c,g,h,d,e,function(a,g,i){return l(b,[c,i,h,d,e,function(b,d,g){return f(new r(a,b),c,g)}])}])}},da=function(a,b){return F(b,a)},
O=function(a,b){return F(a,n(b))},G=n(f.end),x=function(a,b,c){return u(b,function(b){return u(c,function(c){return n(a(b,c))})})},y=function(a){return O(a,f.end)},p=k(x,f.cons),P=k(x,f.concat),H,ea=function(a,b){return p(b,a)};H=function(){return J.call(arguments,ea,G)};var z,fa=function(){throw Error("Many parser applied to a parser that accepts an empty string");};z=function(a){var b=function(b,g,h,d,e,f){return l(a,[b,g,h,d,fa,f])};return C(function(a){return y(p(b,a))})};var I=function(a,b){return 0>=
a?G:p(b,I(a-1,b))},Q=function(a,b){return 0>=a?G:y(p(b,Q(a-1,b)))},ga=function(a,b){return n(b)},R=function(a,b){return p(b,z(E(a,b)))},A,v=function(a,b){e.call(this,a);this.tok=b};v.prototype=new m;v.prototype.constructor=v;Object.defineProperty(v.prototype,"message",{get:function(){return"Unexpected "+tok}});A=function(a){return function(b,c,g,h,d,e){h=b.pos;return(d=b.input)?(d=f.first(d),a(d)?g(d,b.next(d),c):e(new v(h,d),b,c)):e(new m(h,"end of input"),b,c)}};var x=A(i(!0)),S=function(a,b){return A(k(a,
b))},ha=function(a,b){return E(b,a)},T=function(a,b,c,g,e,d){for(a=a(b,{},c,g,e,d);a&&a._next;)a=a[0].apply(void 0,a[1]);return a()},U=function(a,b){return function(c,g){return T(c,g,a,b,a,b)}},B=U(i,function(a){return function(){throw a;}}),V=function(a,b){return B(a,new q(b,j(1,0)))},W=function(a,b){var c=y(u(a,function(a,b){return n(f.stream(a,k(B,c,b)))}));return B(c,b)},X=function(a,b){return W(a,new q(b,j(1,0)))},Y=U(i(i(!0)),i(i(!1))),Z=function(a,b){return Y(a,new q(b,j(1,0)))};return{ParseError:e,
UnknownError:s,UnexpectError:m,ExpectError:t,InputState:q,Position:j,Parser:L,RecParser:C,NamedRecParser:function(a,b){return L(a,C(b))},always:n,never:D,bind:u,binda:M,eof:ca,extract:N,examine:w,attempt:function(a){return function(b,c,e,h,d,f){return l(a,[b,c,e,f,d,f])}},lookahead:function(a){return function(b,c,e,f,d,i){return l(a,[b,c,function(a,c,e){return d(a,b,e)},f,d,i])}},next:E,either:F,choice:function(){return 0===arguments.length?D:J.call(arguments,da)},optional:O,consParser:p,concatParser:P,
sequence:H,many:z,many1:function(a){return p(a,z(a))},times:I,betweenTimes:function(a,b,c){return b<a?D:P(I(a,c),Q(b-a,c))},between:function(a,b,c){return M(H(a,c,b),ga)},sepBy1:R,sepBy:function(a,b){return y(R(a,b))},token:A,anyToken:x,character:function(a,b){return S(b||K,a)},string:function(a,b){return aa.call(a,k(S,b||K)).reduceRight(ha,n(a))},exec:T,runState:B,runStream:V,run:function(a,b){return V(a,f.from(b))},runManyState:W,runManyStream:X,runMany:function(a,b){return X(a,f.from(b))},testState:Y,
testStream:Z,test:function(a,b){return Z(a,f.from(b))}}});
