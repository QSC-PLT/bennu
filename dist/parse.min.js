define(["stream"],function(f){var Y=Array.prototype.join,Z=Array.prototype.map,H=Array.prototype.reduceRight,j=function(a){return 1===arguments.length?a:a.bind.apply(a,arguments)},u=function(a){return a},h=j(j,u),I=function(a,b){return a===b},k=function(a,b){var c=[a,b];c._next=!0;return c},i,$=function(){return"{line: "+this.line+" col: "+this.column+"}"};i=function(a,b){return Object.freeze({line:a,column:b,toString:$})};i.increment=function(a,b){return"\n"===b?i(a.line+1,1):i(a.line,a.column+1)};
var p=function(a,b){this.input=a;this.pos=b};p.prototype.next=function(a){return this._next||(this._next=new p(f.rest(this.input),i.increment(this.pos,a)))};var e=function(a,b){this._messages=b;this.pos=a};e.prototype=Error();e.prototype.constructor=e;e.prototype.name="ParseError";Object.defineProperties(e.prototype,{message:{get:function(){var a=this.messages;return"At position:"+this.pos+" ["+(a?Y.call(a,", "):"")+"]"}},messages:{get:function(){return this._messages}}});var q=function(a,b){this.e1=
a;this.e2=b;e.call(this,a.pos)};q.prototype=new e;q.prototype.constructor=q;q.prototype.name="MultipleError";Object.defineProperty(q.prototype,"messages",{get:function(){return[this.e1.messsage,this.e2.message]}});var r=function(a){e.call(this,a,["Error"])};r.prototype=new e;r.prototype.constructor=r;r.prototype.name="UnknownError";var l=function(a,b){e.call(this,a,["Unexpected "+(b||"")])};l.prototype=new e;l.prototype.constructor=l;l.prototype.name="UnexpectError";var s=function(a,b){e.call(this,
a,["Expected "+(b||"")])};s.prototype=new e;s.prototype.constructor=s;s.prototype.name="ExpectError";var J=function(a,b){return Object.defineProperty(b,"displayName",{value:a,writable:!1})},A=function(a){var b;return b=a(function(){return b.apply(this,arguments)})},m=function(a){return function(b,c,g,d){return d(a,b)}},B=h(function(a,b,c,g,d){return d(new r(a.pos))}),t=function(a,b){return function(c,g,d,aa,e){return k(a,[c,function(a,c){return k(b(a,c),[c,g,d,g,d])},d,function(a,c){return k(b(a,
c),[c,g,d,aa,e])},e])}},K=function(a,b){return t(a,function(a){return b.apply(void 0,f.toArray(a))})},ba=h(function(a,b,c,g,d){return!a.input?g(null,a):d(new s(a.pos,"end of input"))}),L=function(a){return function(b,c,g,d){return d(a(b),b)}},u=j(L,u),C=function(a,b){return t(a,h(b))},v=function(a,b){return function(c,g,d,e,f){return k(a,[c,g,d,e,function(a){return k(b,[c,g,d,e,function(b){return f(new q(a,b))}])}])}},ca=function(a,b){return v(b,a)},M=function(a,b){return v(a,m(b))},w=m(f.end),x=
function(a,b,c){return t(b,function(b){return t(c,function(c){return m(a(b,c))})})},D=function(a){return M(a,f.end)},n=j(x,f.cons),N=j(x,f.concat),E,da=function(a,b){return n(b,a)};E=function(){return H.call(arguments,da,w)};var y,ea=function(){throw Error("Many parser applied to a parser that accepts an empty string");};y=function(a){var b=function(b,g,d,e,f){return k(a,[b,g,d,ea,f])};return A(function(a){return D(n(b,a))})};var F=function(a,b){return 0>=a?w:n(b,F(a-1,b))},O=function(a,b){return 0>=
a?w:D(n(b,O(a-1,b)))},fa=function(a,b){return m(b)},P=function(a,b){return n(b,y(C(a,b)))},G=function(a){return function(b,c,g,d,e){g=b.pos;return(d=b.input)?(d=f.first(d),a(d)?c(d,b.next(d)):e(new l(g,"token:'"+d+"'"))):e(new l(g,"end of input"))}},x=G(h(!0)),Q=function(a,b){return G(j(a,b))},ga=function(a,b){return C(b,a)},R=function(a,b,c,g,d,e){for(a=a(b,c,g,d,e);a&&a._next;)a=a[0].apply(void 0,a[1]);return a()},S=function(a,b){return function(c,e){return R(c,e,a,b,a,b)}},z=S(h,function(a){return function(){throw a;
}}),T=function(a,b){return z(a,new p(b,i(1,0)))},U=function(a,b){var c=D(t(a,function(a,b){return m(f.stream(a,j(z,c,b)))}));return z(c,b)},V=function(a,b){return U(a,new p(b,i(1,0)))},W=S(h(h(!0)),h(h(!1))),X=function(a,b){return W(a,new p(b,i(1,0)))};return{ParseError:e,UnknownError:r,UnexpectError:l,ExpectError:s,InputState:p,Position:i,Parser:J,RecParser:A,NamedRecParser:function(a,b){return J(a,A(b))},always:m,never:B,bind:t,binda:K,eof:ba,extract:L,examine:u,attempt:function(a){return function(b,
c,e,d,f){return k(a,[b,c,f,d,f])}},lookahead:function(a){return function(b,c,e,d,f){return k(a,[b,function(a){return d(a,b)},e,d,f])}},next:C,either:v,choice:function(){return 0===arguments.length?B:H.call(arguments,ca)},optional:M,consParser:n,concatParser:N,sequence:E,many:y,many1:function(a){return n(a,y(a))},times:F,betweenTimes:function(a,b,c){return b<a?B:N(F(a,c),O(b-a,c))},between:function(a,b,c){return K(E(a,c,b),fa)},sepBy1:P,sepBy:function(a,b){return v(P(a,b),w)},token:G,anyToken:x,character:function(a,
b){return Q(b||I,a)},string:function(a,b){return Z.call(a,j(Q,b||I)).reduceRight(ga,m(a))},exec:R,runState:z,runStream:T,run:function(a,b){return T(a,f.from(b))},runManyState:U,runManyStream:V,runMany:function(a,b){return V(a,f.from(b))},testState:W,testStream:X,test:function(a,b){return X(a,f.from(b))}}});
