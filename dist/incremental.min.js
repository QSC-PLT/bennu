define(["require","exports","parse/parse","nu/stream"],function(G,f,g,i){var k,m,j,n,p,q,z=g.always,r=g.bind,v=g.getParserState,w=g.next,A=g.optional,B=g.parseState,s=g.ParserState,t=g.Position,x=g.runState,u=g.trampoline,l=i.end,C=i.isEmpty,D=i.rest,y=function(a,b,c){this.chunk=a;this.state=b;this.k=c},h=function(a,b,c,d){this.done=a;this.state=b;this.k=c;this.chunks=d};h.prototype.addChunk=function(a){return new h(this.done,this.state,this.k,this.chunks.concat(a))};h.prototype.hasChunk=function(a){return a<
this.chunks.length};h.prototype.getChunk=function(a){return this.chunks[a]};var e=function(a,b){this.chunk=a;this.state=b};Object.defineProperties(e,{input:{get:function(){return this.state.input}},position:{get:function(){return this.state.position}},userState:{get:function(){return this.state.userState}}});e.prototype.eq=function(a){return a&&a.chunk===this.chunk&&a.state.eq(a.state)};e.prototype.isEmpty=function(){return this.state.isEmpty()};e.prototype.first=function(){return this.state.first()};
e.prototype.next=function(a){if(!this._next){var b=this.chunk;if(C(D(this.state.input)))return r(w(this.state.next(a),v),function(c){return function(d,f,g){return new y(b+1,c,function(d){return g(a,new e(b+1,c.setInput(d)),f)})}});this._next=w(this.state.next(a),r(v,function(c){var d=new e(b,c);return function(b,c,e){return e(a,d,c)}}))}return this._next};e.prototype.setInput=function(a){return new e(this.chunk,this.state.setInput(a))};e.prototype.setPosition=function(a){return new e(this.chunk,this.state.setPosition(a))};
e.prototype.setUserState=function(a){return new e(this.chunk,this.state.setUserState(a))};k=function(a,b){if(a.done)return a;for(var c=a.addChunk(b),d=u(c.k(c.state.setInput(b)));d instanceof y;){if(!c.hasChunk(d.chunk))return new h(!1,d.state,function(a){return d.k(a.input)},c.chunks);d=u(d.k(c.getChunk(d.chunk)))}return d};m=function(a){return!a.done?m(u(a.k(a.state))):a.k()};j=function(a,b,c,d){var f=function(a,b){return new h(!0,b,c.bind(null,a,b))},g=function(a,b){return new h(!0,b,d.bind(null,
a,b))},b=b.isEmpty()?new h(!1,new e(0,b),function(b){return B(a,b,f,g)},[]):k(j(a,b.setInput(l),c,d),b.input);return b};var E=function(a){return a},F=function(a){throw a;};n=function(a,b){return j(a,b,E,F)};p=function(a,b){var c;var d=A(l,r(a,function(a,b,c){return z(i.memoStream(a,x.bind(null,d,b,c)))}));c=x(d,b);return c};q=function(a,b,c){return p(a,new s(b,t.initial,c))};f.provide=k;f.provideString=function(a,b){return k(a,i.from(b))};f.finish=m;f.parseIncState=j;f.parseInc=function(a,b,c,d){return j(a,
new s(l,t.initial,b),c,d)};f.runIncState=n;f.runInc=function(a,b){return n(a,new s(l,t.initial,b))};f.runManyState=p;f.runManyStream=q;f.runMany=function(a,b,c){return q(a,i.from(b),c)}});
